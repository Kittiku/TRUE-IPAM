<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPAM - Advanced IP Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-used { color: #ef4444; background-color: #fef2f2; }
        .status-available { color: #10b981; background-color: #f0fdf4; }
        .status-reserved { color: #f59e0b; background-color: #fffbeb; }
        .sidebar { width: 280px; }
        .section { display: none; }
        .section.active { display: block; }
        .nav-item.active { background-color: rgba(255,255,255,0.2); }
        
        /* Modal styles */
        .modal { transition: all 0.3s ease; }
        .modal.hidden { opacity: 0; pointer-events: none; }
        .modal:not(.hidden) { opacity: 1; pointer-events: auto; }
        
        /* Toast animation */
        .toast {
            transform: translateX(100%);
            animation: slideIn 0.3s ease-out forwards;
        }
        @keyframes slideIn {
            to { transform: translateX(0); }
        }
        
        /* Button hover effects */
        .action-btn {
            transition: all 0.2s ease;
        }
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* IP table hover effect */
        .ip-row:hover {
            background-color: #f8fafc;
        }
        
        /* Clickable IP styling */
        .clickable-ip {
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .clickable-ip:hover {
            color: #3b82f6;
            text-decoration: underline;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex">
    <!-- Sidebar -->
    <div class="sidebar gradient-bg text-white shadow-lg">
        <div class="p-6">
            <div class="flex items-center mb-8">
                <i class="fas fa-network-wired text-2xl mr-3"></i>
                <h1 class="text-xl font-bold">IPAM</h1>
            </div>
            
            <nav class="space-y-2">
                <a href="#" onclick="showSection('dashboard', this)" class="nav-item active flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                </a>
                <a href="#" onclick="showSection('ip-management', this)" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-list mr-3"></i>IP Management
                </a>
                <a href="#" onclick="showSection('subnet-management', this)" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-sitemap mr-3"></i>Subnet Management
                </a>
                <a href="#" onclick="showSection('vrf-monitoring', this)" class="nav-item flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-project-diagram mr-3"></i>VRF Monitoring
                </a>
            </nav>
            
            <div class="mt-8">
                <h3 class="text-sm font-semibold text-white mb-4 opacity-80">QUICK ACTIONS</h3>
                <div class="space-y-2">
                    <button onclick="openAssignIPModal()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-plus mr-2"></i>Add IP
                    </button>
                    <button onclick="refreshData()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-sync mr-2"></i>Refresh Data
                    </button>
                </div>
            </div>
            
            <div class="mt-8">
                <h3 class="text-sm font-semibold text-white mb-4 opacity-80">TOOLS</h3>
                <div class="space-y-2">
                    <button onclick="openBulkAssignModal()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-download mr-2"></i>Import from CSV
                    </button>
                    <button onclick="clearFilters()" class="w-full flex items-center px-4 py-2 text-sm bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition">
                        <i class="fas fa-times mr-2"></i>Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900" id="page-title">Dashboard Overview</h1>
                        <p class="text-gray-600 text-sm" id="page-subtitle">Real-time network statistics and monitoring</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="refreshData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sync mr-2"></i>Refresh
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active p-6">
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6 card-hover">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Available IPs</p>
                            <p class="text-2xl font-semibold text-green-600" id="available-ips">-</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6 card-hover">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-times-circle text-red-600"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Used IPs</p>
                            <p class="text-2xl font-semibold text-red-600" id="used-ips">-</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6 card-hover">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-bookmark text-yellow-600"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Reserved IPs</p>
                            <p class="text-2xl font-semibold text-yellow-600" id="reserved-ips">-</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6 card-hover">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-network-wired text-purple-600"></i>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Subnets</p>
                            <p class="text-2xl font-semibold text-purple-600" id="total-subnets">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subnet Usage Overview -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-sitemap mr-2 text-purple-600"></i>Subnet Usage Overview
                        </h3>
                        <button onclick="toggleSubnetDetails()" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-chevron-down mr-1"></i>Show Details
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div id="subnet-overview-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading...</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IP Management Section -->
        <div id="ip-management-section" class="section p-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">IP Address Management</h3>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-600" id="total-ips-display">Loading...</span>
                            <button onclick="openAssignIPModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-plus mr-2"></i>Add IP
                            </button>
                        </div>
                    </div>
                    
                    <!-- IP Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Subnet</label>
                            <input type="text" id="ip-subnet-filter" placeholder="e.g., 192.168.1.0/24" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="ip-status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">All Status</option>
                                <option value="used">Used</option>
                                <option value="available">Available</option>
                                <option value="reserved">Reserved</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Domain</label>
                            <input type="text" id="ip-vrf-filter" placeholder="VRF name" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div class="flex items-end">
                            <button onclick="applyIPFilters()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div id="ip-table-container">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading IP data...</p></div>
                    </div>
                    
                    <!-- Pagination -->
                    <div id="ip-pagination" class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-500" id="ip-pagination-info"></div>
                        <div class="flex space-x-2" id="ip-pagination-buttons"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subnet Management Section -->
        <div id="subnet-management-section" class="section p-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Subnet Management</h3>
                            <p class="text-gray-600 text-sm">Analyze and manage IP subnets by CIDR ranges</p>
                        </div>
                        <button onclick="openAddSubnetModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i>Add Subnet
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <!-- Statistics Summary -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4" id="subnet-stats">
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600" id="total-subnets-count">-</div>
                            <div class="text-sm text-blue-600">Total Subnets</div>
                        </div>
                        <div class="bg-red-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-red-600" id="total-used-count">-</div>
                            <div class="text-sm text-red-600">Total Used IPs</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600" id="total-free-count">-</div>
                            <div class="text-sm text-green-600">Total Free IPs</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600" id="avg-utilization">-</div>
                            <div class="text-sm text-purple-600">Avg Utilization</div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- CIDR Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Filter by CIDR:</label>
                                <select id="cidr-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="">All CIDR</option>
                                    <option value="16">/16 (65,536 addresses)</option>
                                    <option value="20">/20 (4,096 addresses)</option>
                                    <option value="22">/22 (1,024 addresses)</option>
                                    <option value="24" selected>/24 (256 addresses)</option>
                                    <option value="25">/25 (128 addresses)</option>
                                    <option value="26">/26 (64 addresses)</option>
                                    <option value="27">/27 (32 addresses)</option>
                                    <option value="28">/28 (16 addresses)</option>
                                    <option value="29">/29 (8 addresses)</option>
                                    <option value="30">/30 (4 addresses)</option>
                                </select>
                            </div>
                            
                            <!-- IP Address Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Filter by IP Range:</label>
                                <input type="text" id="ip-range-filter" placeholder="e.g., 10.235, 172.27, 192.168" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            
                            <!-- Service Domain Filter -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Service Domain:</label>
                                <select id="service-domain-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="">All Domains</option>
                                    <option value="IPRAN-D">IPRAN-D</option>
                                    <option value="RN/AGN">RN/AGN</option>
                                    <option value="IPCORE-BB">IPCORE-BB</option>
                                    <option value="IPCORE-MB">IPCORE-MB</option>
                                    <option value="IPRAN-T">IPRAN-T</option>
                                    <option value="CGNAT">CGNAT</option>
                                    <option value="Service-D">Service-D</option>
                                    <option value="OAM">OAM</option>
                                    <option value="PN">PN</option>
                                    <option value="CORESW">CORESW</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-4 mt-4">
                            <div class="flex space-x-2">
                                <button onclick="applySubnetFilters()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                    <i class="fas fa-filter mr-2"></i>Apply Filters
                                </button>
                                <button onclick="clearSubnetFilters()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    <i class="fas fa-sync mr-2"></i>Clear Filters
                                </button>
                            </div>
                            <div class="text-sm text-gray-500">
                                Quick filters: 
                                <button onclick="setQuickCIDR('16')" class="text-blue-600 hover:underline mx-1">/16</button>
                                <button onclick="setQuickCIDR('20')" class="text-blue-600 hover:underline mx-1">/20</button>
                                <button onclick="setQuickCIDR('24')" class="text-blue-600 hover:underline mx-1">/24</button>
                                <button onclick="setQuickIP('10.235')" class="text-blue-600 hover:underline mx-1">10.235</button>
                                <button onclick="setQuickIP('172.27')" class="text-blue-600 hover:underline mx-1">172.27</button>
                            </div>
                        </div>
                    </div>

                    <!-- Subnet Grid -->
                    <div id="subnet-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading...</p></div>
                    </div>
                    
                    <!-- Subnet List Table -->
                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">Configured Subnets</h4>
                            <button onclick="loadSubnetList()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Refresh List
                            </button>
                        </div>
                        <div class="bg-white border rounded-lg overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subnet</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Section</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">VLAN</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">VRF</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subnet-list-body" class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading subnet list...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- VRF Monitoring Section -->
        <div id="vrf-monitoring-section" class="section p-6">
            <div class="bg-white rounded-lg shadow">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Service Domain Monitoring</h3>
                            <p class="text-gray-600 text-sm">Monitor IP address allocation across network service domains</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-500" id="vrf-last-update">Last updated: Loading...</span>
                            <button onclick="refreshVRFData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div id="vrf-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="text-center py-8"><i class="fas fa-spinner loading-spinner text-2xl"></i><p class="mt-2">Loading VRF data...</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subnet Detail Modal -->
    <div id="subnet-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900" id="modal-subnet-title">Subnet Details</h3>
                        <p class="text-gray-600 text-sm" id="modal-subnet-info">Network information and IP allocation</p>
                    </div>
                    <button onclick="closeSubnetModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <!-- Subnet Summary -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="text-sm text-blue-600 font-medium">Total IPs</div>
                        <div class="text-2xl font-bold text-blue-900" id="modal-total-ips">-</div>
                        <div class="text-xs text-blue-600" id="modal-network-info">-</div>
                    </div>
                    <div class="bg-red-50 rounded-lg p-4">
                        <div class="text-sm text-red-600 font-medium">Used IPs</div>
                        <div class="text-2xl font-bold text-red-900" id="modal-used-ips">-</div>
                        <div class="text-xs text-red-600" id="modal-used-percent">-</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <div class="text-sm text-green-600 font-medium">Available IPs</div>
                        <div class="text-2xl font-bold text-green-900" id="modal-available-ips">-</div>
                        <div class="text-xs text-green-600" id="modal-available-percent">-</div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <div class="text-sm text-yellow-600 font-medium">Reserved IPs</div>
                        <div class="text-2xl font-bold text-yellow-900" id="modal-reserved-ips">-</div>
                        <div class="text-xs text-yellow-600" id="modal-reserved-percent">-</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-purple-600 font-medium">Utilization</div>
                        <div class="text-2xl font-bold text-purple-900" id="modal-utilization">-</div>
                        <div class="w-full bg-purple-200 rounded-full h-2 mt-2">
                            <div class="bg-purple-600 h-2 rounded-full" id="modal-utilization-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Actions -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex justify-between items-center">
                        <h4 class="text-sm font-medium text-gray-700">Bulk Actions for this Subnet</h4>
                        <div class="flex space-x-2">
                            <button onclick="openBulkEditModal()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                <i class="fas fa-edit mr-1"></i>Bulk Edit Subnet
                            </button>
                            <button onclick="reserveEntireSubnet()" class="px-3 py-1 bg-orange-600 text-white text-sm rounded hover:bg-orange-700">
                                <i class="fas fa-lock mr-1"></i>Reserve Subnet
                            </button>
                            <button onclick="assignSubnetToService()" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700">
                                <i class="fas fa-network-wired mr-1"></i>Assign to Service
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Service Domain Summary -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-900 mb-3">Service Domain Summary</h4>
                    <div id="modal-vrf-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- VRF summary will be populated here -->
                    </div>
                </div>

                <!-- IP Filter -->
                <div class="mb-4 flex items-center space-x-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Filter by Status:</label>
                        <select id="modal-ip-filter" onchange="filterModalIPs()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">All IPs</option>
                            <option value="used">Used Only</option>
                            <option value="available">Available Only</option>
                            <option value="reserved">Reserved Only</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Filter by VRF:</label>
                        <select id="modal-vrf-filter" onchange="filterModalIPs()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">All VRFs</option>
                        </select>
                    </div>
                </div>

                <!-- IP List -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP Address</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hostname/Device</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Service Domain</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="modal-ip-list" class="bg-white divide-y divide-gray-200">
                            <!-- IP list will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 space-y-3"></div>    <script>
        // Global state
        let currentSection = 'dashboard';
        let currentPage = 1;
        let currentFilters = {};
        let ipData = [];
        let currentSubnetData = null;

        // Toast notification function
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast bg-white border-l-4 p-4 rounded shadow-lg mb-2 ${
                type === 'success' ? 'border-green-500 text-green-700' : 'border-red-500 text-red-700'
            }`;
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="flex-1">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="ml-4 text-gray-400 hover:text-gray-600 font-bold text-lg">
                        &times;
                    </button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 4000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            showSection('dashboard');
        });

        // Navigation functions
        function showSection(sectionName, triggerElement) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
            
            // Add active class to clicked nav item
            if (triggerElement) {
                triggerElement.closest('.nav-item').classList.add('active');
            } else {
                // Find nav item by onclick attribute for programmatic calls
                const navLink = document.querySelector(`[onclick*="showSection('${sectionName}',"]`);
                if (navLink) {
                    navLink.closest('.nav-item').classList.add('active');
                }
            }
            
            currentSection = sectionName;
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard Overview',
                'ip-management': 'IP Address Management', 
                'subnet-management': 'Subnet Management',
                'vrf-monitoring': 'Service Domain Monitoring'
            };
            
            const subtitles = {
                'dashboard': 'Real-time network statistics and monitoring',
                'ip-management': 'Complete IP address inventory and assignment',
                'subnet-management': 'Subnet analysis and CIDR management',
                'vrf-monitoring': 'Monitor IP allocation across Service Domains'
            };
            
            document.getElementById('page-title').textContent = titles[sectionName] || 'IPAM System';
            document.getElementById('page-subtitle').textContent = subtitles[sectionName] || 'IP Address Management System';
            
            // Load section-specific data
            if (sectionName === 'dashboard') {
                loadDashboardData();
            } else if (sectionName === 'ip-management') {
                loadIPManagement();
            } else if (sectionName === 'subnet-management') {
                loadSubnetManagement();
                loadSubnetList();
            } else if (sectionName === 'vrf-monitoring') {
                loadVRFMonitoring();
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/statistics');
                const data = await response.json();
                
                document.getElementById('available-ips').textContent = data.available_ips?.toLocaleString() || '0';
                document.getElementById('used-ips').textContent = data.used_ips?.toLocaleString() || '0';
                document.getElementById('reserved-ips').textContent = data.reserved_ips?.toLocaleString() || '0';
                document.getElementById('total-subnets').textContent = data.total_subnets?.toLocaleString() || '0';
                
                loadSubnetOverview();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Failed to load dashboard data', 'error');
            }
        }

        // Load IP management section
        async function loadIPManagement() {
            try {
                loadIPList(1); // Load first page
            } catch (error) {
                console.error('Error loading IP management:', error);
                showToast('Failed to load IP management data', 'error');
            }
        }

        // Load IP list with pagination and filters
        async function loadIPList(page = 1) {
            try {
                const subnetFilter = document.getElementById('ip-subnet-filter')?.value || '';
                const statusFilter = document.getElementById('ip-status-filter')?.value || '';
                const vrfFilter = document.getElementById('ip-vrf-filter')?.value || '';
                
                const params = new URLSearchParams({
                    page: page,
                    per_page: 50,
                    subnet: subnetFilter,
                    status: statusFilter,
                    vrf: vrfFilter
                });
                
                const response = await fetch(`/api/ip-list?${params}`);
                const data = await response.json();
                
                // Update total count
                document.getElementById('total-ips-display').textContent = `${data.pagination.total.toLocaleString()} Total IPs`;
                
                // Render IP table
                renderIPTable(data.ips);
                
                // Render pagination
                renderIPPagination(data.pagination, page);
                
            } catch (error) {
                console.error('Error loading IP list:', error);
                document.getElementById('ip-table-container').innerHTML = '<div class="text-center py-8 text-red-500">Failed to load IP data</div>';
            }
        }

        // Render IP table
        function renderIPTable(ips) {
            const container = document.getElementById('ip-table-container');
            
            if (!ips || ips.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">No IP addresses found</div>';
                return;
            }
            
            const tableHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP Address</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subnet</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hostname</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Service Domain</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Updated</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${ips.map(ip => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="font-mono text-sm font-medium text-gray-900">${ip.ip_address}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm text-gray-500">${ip.subnet || '-'}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                            ${ip.status === 'used' ? 'bg-red-100 text-red-800' : 
                                              ip.status === 'available' ? 'bg-green-100 text-green-800' : 
                                              'bg-yellow-100 text-yellow-800'}">
                                            ${ip.status}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm text-gray-900">${ip.hostname || '-'}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm text-purple-600">${ip.vrf_vpn || '-'}</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        ${ip.updated_at || '-'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // Render pagination
        function renderIPPagination(pagination, currentPage) {
            const info = document.getElementById('ip-pagination-info');
            const buttons = document.getElementById('ip-pagination-buttons');
            
            // Update info
            const start = (currentPage - 1) * pagination.per_page + 1;
            const end = Math.min(currentPage * pagination.per_page, pagination.total);
            info.textContent = `Showing ${start}-${end} of ${pagination.total.toLocaleString()} results`;
            
            // Generate pagination buttons
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `<button onclick="loadIPList(${currentPage - 1})" class="px-3 py-2 text-sm border rounded-lg hover:bg-gray-50">Previous</button>`;
            }
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(pagination.pages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage ? 'bg-purple-600 text-white' : 'border hover:bg-gray-50';
                paginationHTML += `<button onclick="loadIPList(${i})" class="px-3 py-2 text-sm rounded-lg ${active}">${i}</button>`;
            }
            
            // Next button
            if (currentPage < pagination.pages) {
                paginationHTML += `<button onclick="loadIPList(${currentPage + 1})" class="px-3 py-2 text-sm border rounded-lg hover:bg-gray-50">Next</button>`;
            }
            
            buttons.innerHTML = paginationHTML;
        }

        // Load subnet management data
        async function loadSubnetManagement() {
            try {
                // Get filter values
                const cidrInput = document.getElementById('cidr-input')?.value || '';
                const ipRangeFilter = document.getElementById('ip-range-filter')?.value || '';
                const serviceDomainFilter = document.getElementById('service-domain-filter')?.value || '';
                
                // Build query parameters
                const params = new URLSearchParams();
                if (cidrInput) {
                    params.append('cidr', cidrInput.replace('/', ''));
                }
                if (ipRangeFilter) {
                    params.append('ip_range', ipRangeFilter);
                }
                if (serviceDomainFilter) {
                    params.append('service_domain', serviceDomainFilter);
                }
                
                // If no CIDR is selected, use 24 as default for display
                if (!cidrInput) {
                    params.append('cidr', '24');
                }
                
                const response = await fetch(`/api/subnet-monitor?${params.toString()}`);
                const data = await response.json();
                
                const container = document.getElementById('subnet-grid');
                
                if (!data.subnets || data.subnets.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No subnet data matches the current filters</div>';
                    return;
                }

                // Update statistics
                const totalUsed = data.subnets.reduce((sum, subnet) => sum + subnet.used, 0);
                const totalFree = data.subnets.reduce((sum, subnet) => sum + subnet.free, 0);
                const totalAddresses = totalUsed + totalFree;
                const avgUtilization = totalAddresses > 0 ? (totalUsed / totalAddresses * 100) : 0;

                document.getElementById('total-subnets-count').textContent = data.total_subnets || data.subnets.length;
                document.getElementById('total-used-count').textContent = totalUsed.toLocaleString();
                document.getElementById('total-free-count').textContent = totalFree.toLocaleString();
                document.getElementById('avg-utilization').textContent = avgUtilization.toFixed(1) + '%';
                
                container.innerHTML = data.subnets.map(subnet => `
                    <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition cursor-pointer border-l-4 border-${getStatusColorClass(subnet.status_color)}-500" onclick="openSubnetDetail('${subnet.subnet}')">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="font-mono text-lg font-semibold text-gray-900">${subnet.subnet}</h4>
                            <span class="text-sm px-3 py-1 bg-blue-100 text-blue-800 rounded-full">
                                private
                            </span>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total IPs:</span>
                                <span class="font-semibold">${subnet.total_addresses.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Used:</span>
                                <span class="font-semibold text-red-600">${subnet.used}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Available:</span>
                                <span class="font-semibold text-green-600">${subnet.free}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Reserved:</span>
                                <span class="font-semibold text-yellow-600">0</span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-${getStatusColorClass(subnet.status_color)}-600 h-2 rounded-full" style="width: ${subnet.usage_percentage}%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Utilization</span>
                                <span>${subnet.usage_percentage}%</span>
                            </div>
                        </div>
                        
                        ${subnet.vrfs ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <div class="text-xs text-gray-500 mb-1">Service Domain:</div>
                                <div class="text-xs text-purple-600 truncate">${subnet.vrfs}</div>
                            </div>
                        ` : ''}
                        
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="text-xs text-gray-500 mb-2">
                                <span class="font-medium">Service Domain:</span> 
                                <span class="text-blue-600">${subnet.vrf_vpns ? subnet.vrf_vpns.join(', ') : 'default'}</span>
                            </div>
                            <div class="text-xs text-blue-600 font-medium">
                                <i class="fas fa-info-circle mr-1"></i>Click to view detailed IP list
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading subnet management:', error);
                showToast('Failed to load subnet data', 'error');
            }
        }

        // Helper function to get status color class
        function getStatusColorClass(color) {
            switch(color) {
                case 'green': return 'green';
                case 'yellow': return 'yellow';
                case 'red': return 'red';
                default: return 'blue';
            }
        }

        // Subnet Filter functions
        function applySubnetFilters() {
            loadSubnetManagement();
            showToast('Filters applied', 'success');
        }

        function clearSubnetFilters() {
            document.getElementById('cidr-input').value = '';
            document.getElementById('ip-range-filter').value = '';
            document.getElementById('service-domain-filter').value = '';
            loadSubnetManagement();
            showToast('All filters cleared', 'success');
        }

        function setQuickCIDR(cidr) {
            document.getElementById('cidr-input').value = cidr;
            loadSubnetManagement();
            showToast(`Filtered by /${cidr}`, 'success');
        }

        function setQuickIP(ipRange) {
            document.getElementById('ip-range-filter').value = ipRange;
            loadSubnetManagement();
            showToast(`Filtered by ${ipRange}`, 'success');
        }

        // Legacy function for compatibility
        function applyCIDRFilter() {
            applySubnetFilters();
        }

        function clearCIDRFilter() {
            clearSubnetFilters();
        }

        // Add event listener for dropdown change
        document.addEventListener('DOMContentLoaded', function() {
            const cidrSelect = document.getElementById('cidr-input');
            if (cidrSelect) {
                cidrSelect.addEventListener('change', function() {
                    loadSubnetManagement();
                    showToast(`Switched to /${this.value} view`, 'success');
                });
            }
        });

        // IP Filter functions
        function applyIPFilters() {
            loadIPList(1); // Reset to first page when filtering
            showToast('IP filters applied', 'success');
        }

        // Load subnet overview
        async function loadSubnetOverview() {
            try {
                const response = await fetch('/api/subnet-monitor?cidr=24&limit=8');
                const data = await response.json();
                
                const container = document.getElementById('subnet-overview-grid');
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No subnet data available</div>';
                    return;
                }
                
                // Show first 8 subnets in overview
                const overviewSubnets = data.slice(0, 8);
                
                container.innerHTML = overviewSubnets.map(subnet => `
                    <div class="bg-gray-50 rounded-lg p-4 border cursor-pointer hover:bg-gray-100" 
                         onclick="openSubnetDetail('${subnet.subnet}')">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-mono text-sm font-semibold text-gray-900">${subnet.subnet}</h4>
                            <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded">
                                /${subnet.prefix_length}
                            </span>
                        </div>
                        <div class="text-xs text-gray-600 mb-2">
                            Used: ${subnet.used_ips}/${subnet.total_ips}
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                            <div class="bg-blue-600 h-1.5 rounded-full" style="width: ${subnet.utilization_percent}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            Available: ${subnet.available_ips} (${subnet.utilization_percent}%)
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading subnet overview:', error);
                document.getElementById('subnet-overview-grid').innerHTML = 
                    '<div class="col-span-full text-center py-8 text-red-500">Failed to load subnet data</div>';
            }
        }

        // Utility functions
        function refreshData() {
            if (currentSection === 'dashboard') {
                loadDashboardData();
            } else if (currentSection === 'ip-management') {
                loadIPList(1);
            } else if (currentSection === 'subnet-management') {
                loadSubnetManagement();
            } else if (currentSection === 'vrf-monitoring') {
                loadVRFMonitoring();
            }
            showToast('Data refreshed successfully', 'success');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 translate-x-full`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }

        // Placeholder functions
        function openAssignIPModal() {
            document.getElementById('add-ip-modal').classList.remove('hidden');
        }

        function closeAddIPModal() {
            document.getElementById('add-ip-modal').classList.add('hidden');
            document.getElementById('add-ip-form').reset();
        }

        function submitIPForm() {
            const form = document.getElementById('add-ip-form');
            const formData = new FormData(form);
            
            const ipData = {
                ip_address: formData.get('ip_address'),
                subnet: formData.get('subnet'),
                status: formData.get('status'),
                vrf_vpn: formData.get('vrf_vpn'),
                hostname: formData.get('hostname'),
                description: formData.get('description')
            };

            // Validate required fields
            if (!ipData.ip_address || !ipData.subnet) {
                alert('IP Address and Subnet are required fields');
                return;
            }

            fetch('/api/add-ip', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(ipData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('IP address added successfully!');
                    closeAddIPModal();
                    // Refresh the IP data
                    if (currentSection === 'ip-management') {
                        loadIPManagement();
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding IP address');
            });
        }

        function openBulkAssignModal() {
            showToast('Bulk assign modal will be implemented', 'info');
        }

        function clearFilters() {
            // Clear IP filters
            document.getElementById('ip-subnet-filter').value = '';
            document.getElementById('ip-status-filter').value = '';
            document.getElementById('ip-vrf-filter').value = '';
            
            // Clear CIDR filter
            document.getElementById('cidr-input').value = '';
            
            // Reload current section
            if (currentSection === 'ip-management') {
                loadIPList(1);
            } else if (currentSection === 'subnet-management') {
                loadSubnetManagement();
            }
            
            showToast('All filters cleared', 'success');
        }

        // VRF Monitoring functions
        async function loadVRFMonitoring() {
            try {
                const response = await fetch('/api/vrf-summary');
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load VRF data');
                }
                
                // Update timestamp
                const now = new Date();
                document.getElementById('vrf-last-update').textContent = `Last updated: ${now.toLocaleTimeString()}`;
                
                const container = document.getElementById('vrf-grid');
                
                if (!data.summary || data.summary.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No VRF data available</div>';
                    return;
                }
                
                container.innerHTML = data.summary.map(vrf => {
                    const statusColor = vrf.status === 'Critical' ? 'red' : 
                                      vrf.status === 'Warning' ? 'yellow' : 'green';
                    
                    return `
                    <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">${vrf.service_domain || 'Unassigned'}</h4>
                            <span class="text-sm px-3 py-1 bg-${statusColor}-100 text-${statusColor}-800 rounded-full">
                                ${vrf.utilization_percent}% Used
                            </span>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Total IPs</span>
                                <span class="font-medium">${vrf.total_ips.toLocaleString()}</span>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Used</span>
                                <span class="font-medium text-red-600">${vrf.used_ips.toLocaleString()}</span>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Available</span>
                                <span class="font-medium text-green-600">${vrf.available_ips.toLocaleString()}</span>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Reserved</span>
                                <span class="font-medium text-yellow-600">${vrf.reserved_ips.toLocaleString()}</span>
                            </div>
                            
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-4">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                     style="width: ${vrf.utilization_percent}%"></div>
                            </div>
                            
                            <div class="text-xs text-gray-500 mt-2">
                                ${vrf.percentage_of_total}% of total infrastructure
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading VRF monitoring:', error);
                document.getElementById('vrf-grid').innerHTML = 
                    '<div class="col-span-full text-center py-8 text-red-500">Failed to load VRF monitoring data</div>';
            }
        }

        function refreshVRFData() {
            loadVRFMonitoring();
            showToast('VRF data refreshed', 'success');
        }
        }

        // Subnet Detail Modal functions
        async function openSubnetDetail(subnet) {
            try {
                showToast('Loading subnet details...', 'info');
                
                const response = await fetch(`/api/subnet-detail/${encodeURIComponent(subnet)}`);
                const data = await response.json();
                
                if (data.error) {
                    showToast(`Error: ${data.error}`, 'error');
                    return;
                }
                
                currentSubnetData = data;
                
                // Update modal content
                document.getElementById('modal-subnet-title').textContent = `Subnet: ${data.subnet}`;
                document.getElementById('modal-subnet-info').textContent = 
                    `Network: ${data.network_address} - ${data.broadcast_address} (/${data.prefix_length})`;
                
                // Update summary cards
                document.getElementById('modal-total-ips').textContent = data.total_ips.toLocaleString();
                document.getElementById('modal-used-ips').textContent = data.used_ips.toLocaleString();
                document.getElementById('modal-available-ips').textContent = data.available_ips.toLocaleString();
                document.getElementById('modal-reserved-ips').textContent = data.reserved_ips.toLocaleString();
                document.getElementById('modal-utilization').textContent = `${data.utilization_percent}%`;
                
                // Update additional info
                document.getElementById('modal-network-info').textContent = `Mask: ${data.subnet_mask}`;
                document.getElementById('modal-used-percent').textContent = `${((data.used_ips / data.total_ips) * 100).toFixed(1)}%`;
                document.getElementById('modal-available-percent').textContent = `${((data.available_ips / data.total_ips) * 100).toFixed(1)}%`;
                document.getElementById('modal-reserved-percent').textContent = `${((data.reserved_ips / data.total_ips) * 100).toFixed(1)}%`;
                document.getElementById('modal-utilization-bar').style.width = `${data.utilization_percent}%`;
                
                // Update VRF summary
                renderVRFSummary(data.vrf_summary);
                
                // Populate VRF filter dropdown
                populateVRFFilter(data.ip_list);
                
                // Render IP list
                renderModalIPList(data.ip_list);
                
                // Show modal
                document.getElementById('subnet-detail-modal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading subnet detail:', error);
                showToast('Failed to load subnet details', 'error');
            }
        }

        function closeSubnetModal() {
            document.getElementById('subnet-detail-modal').classList.add('hidden');
            currentSubnetData = null;
        }

        function renderVRFSummary(vrfSummary) {
            const container = document.getElementById('modal-vrf-summary');
            
            if (!vrfSummary || Object.keys(vrfSummary).length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500">No Service Domain allocation found</div>';
                return;
            }
            
            container.innerHTML = Object.entries(vrfSummary).map(([vrf, counts]) => `
                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="text-sm text-purple-600 font-medium">${vrf}</div>
                    <div class="text-lg font-bold text-purple-900">${counts.used + counts.reserved} IPs</div>
                    <div class="text-xs text-purple-600">Used: ${counts.used}, Reserved: ${counts.reserved}</div>
                </div>
            `).join('');
        }

        function populateVRFFilter(ipList) {
            const vrfFilter = document.getElementById('modal-vrf-filter');
            const vrfs = [...new Set(ipList.map(ip => ip.vrf_vpn).filter(vrf => vrf))];
            
            vrfFilter.innerHTML = '<option value="">All VRFs</option>' + 
                vrfs.map(vrf => `<option value="${vrf}">${vrf}</option>`).join('');
        }

        function renderModalIPList(ipList) {
            const tbody = document.getElementById('modal-ip-list');
            
            if (!ipList || ipList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No IP addresses found</td></tr>';
                return;
            }
            
            tbody.innerHTML = ipList.map(ip => {
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap">
                            <button onclick="editIP('${ip.ip_address}', '${ip.subnet || currentSubnetData.subnet}')" 
                                    class="font-mono text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline cursor-pointer">
                                ${ip.ip_address}
                            </button>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${ip.status === 'used' ? 'bg-red-100 text-red-800' : 
                                  ip.status === 'available' ? 'bg-green-100 text-green-800' : 
                                  'bg-yellow-100 text-yellow-800'}">
                                ${ip.status}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 max-w-xs" title="${ip.hostname || '-'}">
                            <div class="truncate">${ip.hostname || '-'}</div>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 max-w-xs" title="${ip.description || '-'}">
                            <div class="truncate">${ip.description || '-'}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                            <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs">
                                ${ip.vrf_vpn || 'No Service'}
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                            <button onclick="quickEditIP('${ip.ip_address}', 'used')" 
                                    class="text-red-600 hover:text-red-800 mr-2" title="Mark as Used">
                                <i class="fas fa-times-circle"></i>
                            </button>
                            <button onclick="quickEditIP('${ip.ip_address}', 'available')" 
                                    class="text-green-600 hover:text-green-800 mr-2" title="Mark as Available">
                                <i class="fas fa-check-circle"></i>
                            </button>
                            <button onclick="quickEditIP('${ip.ip_address}', 'reserved')" 
                                    class="text-yellow-600 hover:text-yellow-800" title="Mark as Reserved">
                                <i class="fas fa-lock"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterModalIPs() {
            if (!currentSubnetData) return;
            
            const statusFilter = document.getElementById('modal-ip-filter').value;
            const vrfFilter = document.getElementById('modal-vrf-filter').value;
            
            let filteredIPs = currentSubnetData.ip_list;
            
            if (statusFilter) {
                filteredIPs = filteredIPs.filter(ip => ip.status === statusFilter);
            }
            
            if (vrfFilter) {
                filteredIPs = filteredIPs.filter(ip => ip.vrf_vpn === vrfFilter);
            }
            
            renderModalIPList(filteredIPs);
        }

        // Add Subnet Modal Functions
        function openAddSubnetModal() {
            document.getElementById('add-subnet-modal').classList.remove('hidden');
        }

        function closeAddSubnetModal() {
            document.getElementById('add-subnet-modal').classList.add('hidden');
            document.getElementById('add-subnet-form').reset();
        }

        function submitSubnetForm() {
            const form = document.getElementById('add-subnet-form');
            const formData = new FormData(form);
            
            const subnetData = {
                subnet: formData.get('subnet'),
                description: formData.get('description'),
                section: formData.get('section'),
                vlan: formData.get('vlan'),
                device: formData.get('device'),
                nameservers: formData.get('nameservers'),
                master_subnet: formData.get('master_subnet'),
                vrf: formData.get('vrf'),
                customer: formData.get('customer'),
                location: formData.get('location'),
                mark_as_pool: formData.get('mark_as_pool') === 'on',
                mark_as_full: formData.get('mark_as_full') === 'on',
                threshold_percentage: parseInt(formData.get('threshold_percentage')) || 80,
                check_hosts_status: formData.get('check_hosts_status') === 'on',
                discover_new_hosts: formData.get('discover_new_hosts') === 'on',
                resolve_dns_names: formData.get('resolve_dns_names') === 'on',
                show_as_name: formData.get('show_as_name') === 'on',
                irr: formData.get('irr')
            };

            fetch('/api/subnets', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(subnetData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('Subnet added successfully!');
                    closeAddSubnetModal();
                    // Refresh the subnet data
                    if (currentSection === 'subnet-management') {
                        applyCIDRFilter();
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding subnet');
            });
        }

        // Load subnet list
        function loadSubnetList() {
            fetch('/api/subnets')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error loading subnets:', data.error);
                        document.getElementById('subnet-list-body').innerHTML = 
                            '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Error loading subnet list</td></tr>';
                        return;
                    }
                    
                    renderSubnetList(data.subnets);
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('subnet-list-body').innerHTML = 
                        '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Error loading subnet list</td></tr>';
                });
        }

        function renderSubnetList(subnets) {
            const tbody = document.getElementById('subnet-list-body');
            
            if (!subnets || subnets.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No subnets configured</td></tr>';
                return;
            }
            
            tbody.innerHTML = subnets.map(subnet => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium text-gray-900">${subnet.subnet}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">${subnet.description || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${subnet.section || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${subnet.vlan || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${subnet.vrf || '-'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editSubnet(${subnet.id})" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button onclick="deleteSubnet(${subnet.id}, '${subnet.subnet}')" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function editSubnet(subnetId) {
            alert('Edit subnet functionality will be implemented soon');
        }

        function deleteSubnet(subnetId, subnetName) {
            if (!confirm(`Are you sure you want to delete subnet ${subnetName}?`)) {
                return;
            }
            
            fetch(`/api/subnets/${subnetId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('Subnet deleted successfully!');
                    loadSubnetList();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting subnet');
            });
        }

        // Edit IP Functions
        function editIP(ipAddress, subnet) {
            // Get current IP data
            fetch(`/api/ip-details?ip=${ipAddress}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }
                    
                    // Populate edit form
                    document.getElementById('edit-ip-original').value = ipAddress;
                    document.getElementById('edit-ip-address').value = ipAddress;
                    document.getElementById('edit-ip-subnet').value = subnet;
                    document.getElementById('edit-ip-status').value = data.status || 'available';
                    document.getElementById('edit-ip-vrf').value = data.vrf_vpn || '';
                    document.getElementById('edit-ip-hostname').value = data.hostname || '';
                    document.getElementById('edit-ip-description').value = data.description || '';
                    
                    // Show modal
                    document.getElementById('edit-ip-modal').classList.remove('hidden');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading IP details');
                });
        }

        function closeEditIPModal() {
            document.getElementById('edit-ip-modal').classList.add('hidden');
        }

        function submitEditIPForm() {
            const form = document.getElementById('edit-ip-form');
            const formData = new FormData(form);
            
            const ipData = {
                ip_address: formData.get('ip_address'),
                subnet: formData.get('subnet'),
                status: formData.get('status'),
                vrf_vpn: formData.get('vrf_vpn'),
                hostname: formData.get('hostname'),
                description: formData.get('description')
            };

            fetch(`/api/edit-ip/${formData.get('original_ip')}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(ipData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert('IP updated successfully!');
                    closeEditIPModal();
                    // Refresh the current view
                    if (currentSubnetData) {
                        openSubnetDetail(currentSubnetData.subnet);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating IP');
            });
        }

        function quickEditIP(ipAddress, newStatus) {
            if (!confirm(`Change ${ipAddress} to ${newStatus}?`)) {
                return;
            }

            fetch(`/api/quick-edit-ip/${ipAddress}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status: newStatus })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    showToast(`${ipAddress} changed to ${newStatus}`, 'success');
                    // Refresh the current view
                    if (currentSubnetData) {
                        openSubnetDetail(currentSubnetData.subnet);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating IP status');
            });
        }

        // Bulk Edit Functions
        function openBulkEditModal() {
            if (!currentSubnetData) {
                alert('No subnet selected');
                return;
            }
            
            document.getElementById('bulk-edit-subnet').value = currentSubnetData.subnet;
            document.getElementById('bulk-edit-subnet-name').textContent = currentSubnetData.subnet;
            document.getElementById('bulk-edit-modal').classList.remove('hidden');
        }

        function closeBulkEditModal() {
            document.getElementById('bulk-edit-modal').classList.add('hidden');
            document.getElementById('bulk-edit-form').reset();
            toggleBulkOptions();
        }

        function toggleBulkOptions() {
            const actionType = document.getElementById('bulk-action-type').value;
            
            // Hide all option groups
            document.getElementById('status-options').classList.add('hidden');
            document.getElementById('service-options').classList.add('hidden');
            document.getElementById('range-options').classList.add('hidden');
            
            // Show relevant options
            if (actionType === 'change_status') {
                document.getElementById('status-options').classList.remove('hidden');
            } else if (actionType === 'assign_service') {
                document.getElementById('service-options').classList.remove('hidden');
            } else if (actionType === 'reserve_range' || actionType === 'release_range') {
                document.getElementById('range-options').classList.remove('hidden');
            }
        }

        function submitBulkEditForm() {
            const form = document.getElementById('bulk-edit-form');
            const formData = new FormData(form);
            
            const actionType = formData.get('action_type');
            if (!actionType) {
                alert('Please select an action');
                return;
            }

            const bulkData = {
                subnet: formData.get('subnet'),
                action_type: actionType,
                new_status: formData.get('new_status'),
                service_domain: formData.get('service_domain'),
                start_ip: formData.get('start_ip'),
                end_ip: formData.get('end_ip'),
                description: formData.get('description')
            };

            const confirmMessage = `Are you sure you want to apply this bulk action to subnet ${bulkData.subnet}?`;
            if (!confirm(confirmMessage)) {
                return;
            }

            fetch('/api/bulk-edit-subnet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(bulkData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert(`Bulk operation completed! ${data.affected_count} IPs updated.`);
                    closeBulkEditModal();
                    // Refresh the current view
                    if (currentSubnetData) {
                        openSubnetDetail(currentSubnetData.subnet);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error performing bulk operation');
            });
        }

        // Quick Subnet Actions
        function reserveEntireSubnet() {
            if (!currentSubnetData) return;
            
            if (!confirm(`Reserve all available IPs in subnet ${currentSubnetData.subnet}?`)) {
                return;
            }

            fetch('/api/bulk-edit-subnet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    subnet: currentSubnetData.subnet,
                    action_type: 'change_status',
                    new_status: 'reserved',
                    description: 'Reserved entire subnet'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert(`${data.affected_count} IPs reserved successfully!`);
                    openSubnetDetail(currentSubnetData.subnet);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error reserving subnet');
            });
        }

        function assignSubnetToService() {
            if (!currentSubnetData) return;
            
            const serviceDomain = prompt('Enter Service Domain (e.g., IPRAN-D, RN/AGN):');
            if (!serviceDomain) return;

            if (!confirm(`Assign all IPs in subnet ${currentSubnetData.subnet} to service domain "${serviceDomain}"?`)) {
                return;
            }

            fetch('/api/bulk-edit-subnet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    subnet: currentSubnetData.subnet,
                    action_type: 'assign_service',
                    service_domain: serviceDomain,
                    description: `Assigned to ${serviceDomain}`
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    alert(`${data.affected_count} IPs assigned to ${serviceDomain} successfully!`);
                    openSubnetDetail(currentSubnetData.subnet);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error assigning subnet to service');
            });
        }

        function toggleSubnetDetails() {
            showToast('Subnet details toggle will be implemented', 'info');
        }
    </script>

    <!-- Add IP Modal -->
    <div id="add-ip-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Add New IP Address</h3>
                    <button onclick="closeAddIPModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="add-ip-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- IP Address -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">IP Address *</label>
                            <input type="text" name="ip_address" placeholder="e.g., 192.168.1.100" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                            <p class="text-xs text-gray-500 mt-1">Required field</p>
                        </div>
                        
                        <!-- Subnet -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Subnet *</label>
                            <input type="text" name="subnet" placeholder="e.g., 192.168.1.0/24" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                            <p class="text-xs text-gray-500 mt-1">Required field</p>
                        </div>
                        
                        <!-- Status -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="available">Available</option>
                                <option value="used">Used</option>
                                <option value="reserved">Reserved</option>
                            </select>
                        </div>
                        
                        <!-- Service Domain / VRF -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Domain</label>
                            <input type="text" name="vrf_vpn" placeholder="e.g., IPRAN-D, RN/AGN" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        
                        <!-- Hostname -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hostname</label>
                            <input type="text" name="hostname" placeholder="e.g., router-01" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        
                        <!-- Description -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <input type="text" name="description" placeholder="Enter description" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeAddIPModal()" 
                                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="button" onclick="submitIPForm()" 
                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            <i class="fas fa-plus mr-2"></i>Add IP
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit IP Modal -->
    <div id="edit-ip-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Edit IP Address</h3>
                    <button onclick="closeEditIPModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="edit-ip-form" class="space-y-4">
                    <input type="hidden" id="edit-ip-original" name="original_ip">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- IP Address -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">IP Address</label>
                            <input type="text" id="edit-ip-address" name="ip_address" readonly
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed">
                        </div>
                        
                        <!-- Subnet -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Subnet</label>
                            <input type="text" id="edit-ip-subnet" name="subnet" readonly
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed">
                        </div>
                        
                        <!-- Status -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="edit-ip-status" name="status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="available">Available</option>
                                <option value="used">Used</option>
                                <option value="reserved">Reserved</option>
                            </select>
                        </div>
                        
                        <!-- Service Domain / VRF -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Domain</label>
                            <select id="edit-ip-vrf" name="vrf_vpn" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">No Service Domain</option>
                                <option value="IPRAN-D">IPRAN-D</option>
                                <option value="RN/AGN">RN/AGN</option>
                                <option value="IPCORE-BB">IPCORE-BB</option>
                                <option value="IPCORE-MB">IPCORE-MB</option>
                                <option value="IPRAN-T">IPRAN-T</option>
                                <option value="CGNAT">CGNAT</option>
                                <option value="Service-D">Service-D</option>
                                <option value="OAM">OAM</option>
                                <option value="PN">PN</option>
                                <option value="CORESW">CORESW</option>
                            </select>
                        </div>
                        
                        <!-- Hostname -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hostname</label>
                            <input type="text" id="edit-ip-hostname" name="hostname" placeholder="e.g., router-01" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        
                        <!-- Description -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <input type="text" id="edit-ip-description" name="description" placeholder="Enter description" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeEditIPModal()" 
                                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="button" onclick="submitEditIPForm()" 
                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            <i class="fas fa-save mr-2"></i>Update IP
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bulk Edit Subnet Modal -->
    <div id="bulk-edit-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Bulk Edit Subnet</h3>
                    <button onclick="closeBulkEditModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="flex">
                        <i class="fas fa-exclamation-triangle text-yellow-400 mr-2 mt-1"></i>
                        <div>
                            <h4 class="text-sm font-medium text-yellow-800">Warning</h4>
                            <p class="text-sm text-yellow-700">This will affect all IP addresses in subnet <span id="bulk-edit-subnet-name" class="font-mono"></span></p>
                        </div>
                    </div>
                </div>
                
                <form id="bulk-edit-form" class="space-y-4">
                    <input type="hidden" id="bulk-edit-subnet" name="subnet">
                    
                    <!-- Action Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Action</label>
                        <select id="bulk-action-type" name="action_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" onchange="toggleBulkOptions()">
                            <option value="">Select Action</option>
                            <option value="change_status">Change Status for All IPs</option>
                            <option value="assign_service">Assign Service Domain to All IPs</option>
                            <option value="reserve_range">Reserve IP Range</option>
                            <option value="release_range">Release Reserved IPs</option>
                        </select>
                    </div>
                    
                    <!-- Status Change Options -->
                    <div id="status-options" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">New Status</label>
                        <select id="bulk-new-status" name="new_status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="available">Available</option>
                            <option value="used">Used</option>
                            <option value="reserved">Reserved</option>
                        </select>
                    </div>
                    
                    <!-- Service Domain Options -->
                    <div id="service-options" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Service Domain</label>
                        <select id="bulk-service-domain" name="service_domain" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">No Service Domain</option>
                            <option value="IPRAN-D">IPRAN-D</option>
                            <option value="RN/AGN">RN/AGN</option>
                            <option value="IPCORE-BB">IPCORE-BB</option>
                            <option value="IPCORE-MB">IPCORE-MB</option>
                            <option value="IPRAN-T">IPRAN-T</option>
                            <option value="CGNAT">CGNAT</option>
                            <option value="Service-D">Service-D</option>
                            <option value="OAM">OAM</option>
                            <option value="PN">PN</option>
                            <option value="CORESW">CORESW</option>
                        </select>
                    </div>
                    
                    <!-- IP Range Options -->
                    <div id="range-options" class="hidden">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Start IP</label>
                                <input type="text" id="bulk-start-ip" name="start_ip" placeholder="e.g., 192.168.1.10" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">End IP</label>
                                <input type="text" id="bulk-end-ip" name="end_ip" placeholder="e.g., 192.168.1.20" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description (optional)</label>
                        <input type="text" id="bulk-description" name="description" placeholder="Reason for this change" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeBulkEditModal()" 
                                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="button" onclick="submitBulkEditForm()" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Apply Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Subnet Modal -->
    <div id="add-subnet-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Add New Subnet</h3>
                    <button onclick="closeAddSubnetModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <form id="add-subnet-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Left Column -->
                        <div class="space-y-4">
                            <!-- Subnet -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Subnet *</label>
                                <input type="text" name="subnet" placeholder="Enter subnet in CIDR format (e.g., 192.168.1.0/24)" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <p class="text-xs text-gray-500 mt-1">Required field</p>
                            </div>
                            
                            <!-- Description -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <input type="text" name="description" placeholder="Enter subnet description" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Section -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Section</label>
                                <select name="section" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Select section</option>
                                    <option value="Public - IPv4">Public - IPv4</option>
                                    <option value="Private - IPv4">Private - IPv4</option>
                                    <option value="Management">Management</option>
                                    <option value="DMZ">DMZ</option>
                                </select>
                            </div>
                            
                            <!-- VLAN -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">VLAN</label>
                                <input type="text" name="vlan" placeholder="Enter VLAN ID" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Device -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Device</label>
                                <input type="text" name="device" placeholder="Enter device name" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Nameservers -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nameservers</label>
                                <input type="text" name="nameservers" placeholder="Enter nameservers (comma separated)" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div class="space-y-4">
                            <!-- Master Subnet -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Master Subnet</label>
                                <input type="text" name="master_subnet" placeholder="Enter master subnet if nested" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- VRF -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">VRF</label>
                                <input type="text" name="vrf" placeholder="Enter VRF name" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Customer -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Customer</label>
                                <input type="text" name="customer" placeholder="Enter customer name" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Location -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                <input type="text" name="location" placeholder="Enter location" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- Threshold Percentage -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Threshold Percentage</label>
                                <input type="number" name="threshold_percentage" value="80" min="0" max="100" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            
                            <!-- IRR -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">IRR</label>
                                <select name="irr" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">No</option>
                                    <option value="Yes">Yes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkboxes Section -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">Configuration Options</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" name="mark_as_pool" class="mr-2">
                                <span class="text-sm text-gray-700">Mark as Pool</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="mark_as_full" class="mr-2">
                                <span class="text-sm text-gray-700">Mark as Full</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="check_hosts_status" class="mr-2">
                                <span class="text-sm text-gray-700">Check Hosts Status</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="discover_new_hosts" class="mr-2">
                                <span class="text-sm text-gray-700">Discover New Hosts</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="resolve_dns_names" class="mr-2">
                                <span class="text-sm text-gray-700">Resolve DNS Names</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="show_as_name" class="mr-2">
                                <span class="text-sm text-gray-700">Show as Name</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeAddSubnetModal()" 
                                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="button" onclick="submitSubnetForm()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Add Subnet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</body>
</html>
