<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced IPAM - IP Address Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar-gradient {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .loading {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal-overlay {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Sidebar -->
    <div class="fixed inset-y-0 left-0 w-64 sidebar-gradient text-white z-50">
        <div class="flex items-center justify-center h-20 shadow-md">
            <i class="fas fa-network-wired text-2xl mr-3"></i>
            <h1 class="text-xl font-bold">IPAM</h1>
        </div>
        
        <nav class="mt-8">
            <div class="px-4">
                <div class="flex items-center px-4 py-3 bg-white bg-opacity-20 rounded-lg mb-2">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    <span>Dashboard</span>
                </div>
                
                <div class="flex items-center px-4 py-3 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2" onclick="showSection('ip-management')">
                    <i class="fas fa-network-wired mr-3"></i>
                    <span>IP Management</span>
                </div>
                
                <div class="flex items-center px-4 py-3 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2" onclick="showSection('subnet-management')">
                    <i class="fas fa-sitemap mr-3"></i>
                    <span>Subnet Management</span>
                </div>
            </div>
            
            <div class="mt-8 px-4">
                <p class="text-xs uppercase text-purple-200 mb-4">Quick Actions</p>
                
                <div class="flex items-center px-4 py-2 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2" onclick="openAddModal()">
                    <i class="fas fa-plus mr-3 text-sm"></i>
                    <span class="text-sm">Add IP</span>
                </div>
                
                <div class="flex items-center px-4 py-2 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2" onclick="showSection('analyze-subnet')">
                    <i class="fas fa-chart-pie mr-3 text-sm"></i>
                    <span class="text-sm">Analyze Subnet</span>
                </div>
                
                <div class="flex items-center px-4 py-2 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2" onclick="refreshData()">
                    <i class="fas fa-sync-alt mr-3 text-sm"></i>
                    <span class="text-sm">Refresh Data</span>
                </div>
            </div>
            
            <div class="mt-8 px-4">
                <p class="text-xs uppercase text-purple-200 mb-4">Tools</p>
                
                <div class="flex items-center px-4 py-2 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2">
                    <i class="fas fa-download mr-3 text-sm"></i>
                    <span class="text-sm">Import from CSV</span>
                </div>
                
                <div class="flex items-center px-4 py-2 hover:bg-white hover:bg-opacity-10 rounded-lg cursor-pointer mb-2" onclick="clearFilters()">
                    <i class="fas fa-times mr-3 text-sm"></i>
                    <span class="text-sm">Clear Filters</span>
                </div>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between px-8 py-4">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-network-wired text-purple-600 mr-2"></i>
                        Advanced IP Management
                    </h1>
                    <p class="text-gray-600 text-sm">Complete IP Address & Subnet Management System</p>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="refreshData()" class="flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="p-8">
            <!-- Statistics Overview -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">IP Address Management 
                    <span id="total-overview" class="text-purple-600 text-lg">Loading...</span>
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Total IPs -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-full">
                                <i class="fas fa-list text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total IP Space</p>
                                <p id="total-ips" class="text-2xl font-bold text-blue-600">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Used IPs -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-red-100 p-3 rounded-full">
                                <i class="fas fa-times-circle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Used IPs</p>
                                <p id="used-ips" class="text-2xl font-bold text-red-600">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Available IPs -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-full">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Available IPs</p>
                                <p id="available-ips" class="text-2xl font-bold text-green-600">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total Subnets -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-purple-100 p-3 rounded-full">
                                <i class="fas fa-sitemap text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Subnets</p>
                                <p id="total-subnets" class="text-2xl font-bold text-purple-600">-</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Monitoring Section -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-chart-bar text-purple-600 mr-2"></i>
                        Advanced IP Monitoring
                    </h3>
                    <button onclick="loadAdvancedMonitoring()" class="text-purple-600 hover:text-purple-800 text-sm">
                        <i class="fas fa-sync-alt mr-1"></i>Refresh
                    </button>
                </div>
                
                <!-- IP Type Categories -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <!-- Public IPs -->
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-blue-800">
                                <i class="fas fa-globe mr-2"></i>Public IPs
                            </h4>
                            <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded-full">Global</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total:</span>
                                <span id="public-total" class="font-semibold text-blue-700">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Used:</span>
                                <span id="public-used" class="font-semibold text-red-600">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Available:</span>
                                <span id="public-available" class="font-semibold text-green-600">-</span>
                            </div>
                        </div>
                        <div class="mt-3 bg-blue-200 rounded-full h-2">
                            <div id="public-progress" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Private IPs -->
                    <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-green-800">
                                <i class="fas fa-shield-alt mr-2"></i>Private IPs
                            </h4>
                            <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">Internal</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total:</span>
                                <span id="private-total" class="font-semibold text-green-700">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Used:</span>
                                <span id="private-used" class="font-semibold text-red-600">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Available:</span>
                                <span id="private-available" class="font-semibold text-green-600">-</span>
                            </div>
                        </div>
                        <div class="mt-3 bg-green-200 rounded-full h-2">
                            <div id="private-progress" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- WAN IPs -->
                    <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-orange-800">
                                <i class="fas fa-satellite-dish mr-2"></i>WAN IPs
                            </h4>
                            <span class="text-xs bg-orange-200 text-orange-800 px-2 py-1 rounded-full">P2P</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total:</span>
                                <span id="wan-total" class="font-semibold text-orange-700">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Used:</span>
                                <span id="wan-used" class="font-semibold text-red-600">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Available:</span>
                                <span id="wan-available" class="font-semibold text-green-600">-</span>
                            </div>
                        </div>
                        <div class="mt-3 bg-orange-200 rounded-full h-2">
                            <div id="wan-progress" class="bg-orange-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Global/Other IPs -->
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-purple-800">
                                <i class="fas fa-question-circle mr-2"></i>Global/Other
                            </h4>
                            <span class="text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full">Mixed</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total:</span>
                                <span id="global-total" class="font-semibold text-purple-700">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Used:</span>
                                <span id="global-used" class="font-semibold text-red-600">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Available:</span>
                                <span id="global-available" class="font-semibold text-green-600">-</span>
                            </div>
                        </div>
                        <div class="mt-3 bg-purple-200 rounded-full h-2">
                            <div id="global-progress" class="bg-purple-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- VRF/VPN Monitoring -->
                <div class="border-t border-gray-200 pt-6">
                    <h4 class="font-semibold text-gray-800 mb-4">
                        <i class="fas fa-network-wired text-purple-600 mr-2"></i>
                        VRF/VPN Monitoring
                    </h4>
                    <div id="vrf-monitoring" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- VRF/VPN cards will be loaded here -->
                        <div class="text-center py-8 col-span-full">
                            <div class="loading mx-auto mb-4"></div>
                            <p class="text-gray-500">Loading VRF/VPN data...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subnet Usage Overview -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-chart-pie text-purple-600 mr-2"></i>
                        Subnet Usage Overview
                    </h3>
                    <button onclick="loadSubnetOverview()" class="text-purple-600 hover:text-purple-800 text-sm">
                        <i class="fas fa-chevron-down mr-1"></i>Show Details
                    </button>
                </div>
                
                <div id="subnet-overview-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Subnet cards will be loaded here -->
                    <div class="text-center py-8">
                        <div class="loading mx-auto mb-4"></div>
                        <p class="text-gray-500">Loading subnet overview...</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Search Subnet -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-search text-purple-600 mr-2"></i>
                        Analyze Subnet
                    </h3>
                    <div class="space-y-3">
                        <input type="text" id="quick-subnet-input" placeholder="Enter subnet (e.g., 172.207.0.0/16)" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <button onclick="quickAnalyzeSubnet()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-search mr-2"></i>Analyze Subnet
                        </button>
                    </div>
                </div>
                
                <!-- Add IP -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-plus text-green-600 mr-2"></i>
                        Add New IP
                    </h3>
                    <div class="space-y-3">
                        <p class="text-gray-600 text-sm">Quickly add a new IP address to your inventory</p>
                        <button onclick="openAddModal()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add IP Address
                        </button>
                    </div>
                </div>
                
                <!-- Import Data -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-download text-blue-600 mr-2"></i>
                        Import from CSV
                    </h3>
                    <div class="space-y-3">
                        <p class="text-gray-600 text-sm">Import network data from CSV files</p>
                        <button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-download mr-2"></i>Import from CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- IP Management Section -->
        <div id="ip-management-section" class="p-8 hidden">
            <!-- Search and Filter Controls -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <h2 class="text-xl font-semibold text-gray-800">IP Address Inventory</h2>
                    
                    <div class="flex items-center space-x-4">
                        <input type="text" id="search-input" placeholder="Search IP, hostname, description..."
                               class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 w-64">
                        
                        <select id="status-filter" class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">All Status</option>
                            <option value="used">Used</option>
                            <option value="available">Available</option>
                            <option value="reserved">Reserved</option>
                        </select>
                        
                        <button onclick="loadIPData()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-search mr-1"></i>Search
                        </button>
                        
                        <button onclick="clearFilters()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-times mr-1"></i>Clear
                        </button>
                        
                        <button onclick="openAddModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add IP
                        </button>
                    </div>
                </div>
            </div>

            <!-- IP Table -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP Address</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subnet</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">VRF/VPN</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hostname</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Updated</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ip-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Loading state -->
                            <tr>
                                <td colspan="8" class="px-6 py-8 text-center">
                                    <div class="flex justify-center items-center">
                                        <div class="loading mr-3"></div>
                                        <span class="text-gray-500">Loading IP address data...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="bg-gray-50 px-6 py-3 flex items-center justify-between border-t border-gray-200">
                    <div class="flex-1 flex justify-between sm:hidden">
                        <button onclick="previousPage()" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Previous
                        </button>
                        <button onclick="nextPage()" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Next
                        </button>
                    </div>
                    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                        <div>
                            <p class="text-sm text-gray-700">
                                Showing <span id="showing-from">1</span> to <span id="showing-to">50</span> of <span id="showing-total">0</span> results
                            </p>
                        </div>
                        <div>
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
                                <button onclick="previousPage()" id="prev-btn" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                                    Page <span id="current-page">1</span> of <span id="total-pages">1</span>
                                </span>
                                <button onclick="nextPage()" id="next-btn" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subnet Analysis Section -->
        <div id="analyze-subnet-section" class="p-8 hidden">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-chart-pie text-purple-600 mr-2"></i>Subnet Analysis
                    </h2>
                </div>
                
                <div class="flex items-center space-x-4 mb-4">
                    <input type="text" id="subnet-input" placeholder="Enter subnet (e.g., 172.207.0.0/16 or 192.168.1.0/24)"
                           class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 flex-1">
                    
                    <button onclick="analyzeSubnet()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors">
                        <i class="fas fa-search mr-2"></i>Analyze Subnet
                    </button>
                    
                    <button onclick="clearSubnetAnalysis()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-times mr-1"></i>Clear
                    </button>
                </div>
                
                <!-- Subnet Analysis Results -->
                <div id="subnet-analysis-results" class="hidden">
                    <!-- Subnet Info -->
                    <div class="bg-gray-50 rounded-lg p-6 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Network</div>
                                <div id="subnet-network" class="font-semibold text-gray-800">-</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Subnet Mask</div>
                                <div id="subnet-mask" class="font-semibold text-gray-800">-</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Total IPs</div>
                                <div id="subnet-total" class="font-semibold text-blue-600">-</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Utilization</div>
                                <div id="subnet-utilization" class="font-semibold text-purple-600">-</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Used IPs</div>
                                <div id="subnet-used" class="font-semibold text-red-600">-</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Available IPs</div>
                                <div id="subnet-available" class="font-semibold text-green-600">-</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600">Reserved IPs</div>
                                <div id="subnet-reserved" class="font-semibold text-orange-600">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Subnet IP Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP Address</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hostname</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">VRF/VPN</th>
                                </tr>
                            </thead>
                            <tbody id="subnet-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Subnet analysis results will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Subnet Pagination -->
                    <div class="bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200 mt-4">
                        <div class="flex-1 flex justify-between items-center">
                            <div class="text-sm text-gray-700">
                                Showing <span id="subnet-showing-from">1</span> to <span id="subnet-showing-to">50</span> of <span id="subnet-showing-total">0</span> IPs
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="previousSubnetPage()" id="subnet-prev-btn" class="px-3 py-1 text-sm border rounded hover:bg-gray-100 disabled:opacity-50" disabled>
                                    Previous
                                </button>
                                <span class="px-3 py-1 text-sm text-gray-600">
                                    Page <span id="subnet-current-page">1</span> of <span id="subnet-total-pages">1</span>
                                </span>
                                <button onclick="nextSubnetPage()" id="subnet-next-btn" class="px-3 py-1 text-sm border rounded hover:bg-gray-100 disabled:opacity-50" disabled>
                                    Next
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit IP Modal -->
    <div id="ip-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="modal-title" class="text-lg font-semibold text-gray-800">Add New IP Address</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="ip-form" class="space-y-4">
                    <input type="hidden" id="edit-id" value="">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">IP Address *</label>
                        <input type="text" id="ip-address" required 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="192.168.1.100">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Subnet *</label>
                        <input type="text" id="subnet" required 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="192.168.1.0/24">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                        <select id="status" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">Select Status</option>
                            <option value="used">Used</option>
                            <option value="available">Available</option>
                            <option value="reserved">Reserved</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">VRF/VPN</label>
                        <input type="text" id="vrf-vpn" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="VRF_MGMT">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hostname</label>
                        <input type="text" id="hostname" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="server01.example.com">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="description" rows="3"
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                  placeholder="Web server for production environment"></textarea>
                    </div>

                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="button" onclick="saveIP()" 
                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Confirm Delete</h3>
                    <button onclick="closeDeleteModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <p class="text-gray-600 mb-6">Are you sure you want to delete this IP address? This action cannot be undone.</p>

                <div class="flex justify-end space-x-3">
                    <button onclick="closeDeleteModal()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button onclick="confirmDelete()" 
                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPage = 1;
        let totalPages = 1;
        let deleteIPId = null;
        
        // Subnet Analysis variables
        let subnetCurrentPage = 1;
        let subnetTotalPages = 1;
        let subnetData = [];
        const subnetPageSize = 50;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadStatistics();
            loadIPData();
            loadSubnetOverview();
            loadAdvancedMonitoring();
        });

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('ip-management-section').classList.add('hidden');
            document.getElementById('analyze-subnet-section').classList.add('hidden');
            
            // Show selected section
            if (sectionName === 'ip-management') {
                document.getElementById('ip-management-section').classList.remove('hidden');
                loadIPData();
            } else if (sectionName === 'analyze-subnet') {
                document.getElementById('analyze-subnet-section').classList.remove('hidden');
            } else {
                document.getElementById('dashboard-section').classList.remove('hidden');
                loadSubnetOverview();
                loadAdvancedMonitoring();
            }
        }

        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch('/api/statistics');
                const stats = await response.json();

                document.getElementById('total-overview').textContent = `${stats.total_ips?.toLocaleString() || 0} Total IP Space`;
                document.getElementById('total-ips').textContent = stats.total_ips?.toLocaleString() || 0;
                document.getElementById('available-ips').textContent = stats.available_ips?.toLocaleString() || 0;
                document.getElementById('used-ips').textContent = stats.used_ips?.toLocaleString() || 0;
                document.getElementById('total-subnets').textContent = stats.total_subnets?.toLocaleString() || 0;

            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Load advanced monitoring
        async function loadAdvancedMonitoring() {
            try {
                const response = await fetch('/api/advanced-monitoring');
                const data = await response.json();

                // Update IP Type Categories
                updateIPCategory('public', data.ip_public);
                updateIPCategory('private', data.ip_private);
                updateIPCategory('wan', data.ip_wan);
                updateIPCategory('global', data.ip_global);
                
                // Update VRF/VPN Monitoring
                updateVRFMonitoring(data.vrf_vpn);

            } catch (error) {
                console.error('Error loading advanced monitoring:', error);
            }
        }

        function updateIPCategory(type, data) {
            const total = data.total || 0;
            const used = data.used || 0;
            const available = data.available || 0;
            const utilization = total > 0 ? Math.round((used / total) * 100) : 0;

            document.getElementById(`${type}-total`).textContent = total.toLocaleString();
            document.getElementById(`${type}-used`).textContent = used.toLocaleString();
            document.getElementById(`${type}-available`).textContent = available.toLocaleString();
            document.getElementById(`${type}-progress`).style.width = `${utilization}%`;
        }

        function updateVRFMonitoring(vrfData) {
            const container = document.getElementById('vrf-monitoring');
            container.innerHTML = '';

            if (!vrfData || Object.keys(vrfData).length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-info-circle text-4xl mb-4"></i>
                        <p>No VRF/VPN data available</p>
                    </div>
                `;
                return;
            }

            Object.entries(vrfData).forEach(([vrf, data]) => {
                const total = data.total || 0;
                const used = data.used || 0;
                const available = data.available || 0;
                const utilization = total > 0 ? Math.round((used / total) * 100) : 0;
                
                const utilizationColor = utilization > 80 ? 'text-red-600' : 
                                       utilization > 50 ? 'text-yellow-600' : 'text-green-600';
                
                const progressColor = utilization > 80 ? 'bg-red-500' : 
                                    utilization > 50 ? 'bg-yellow-500' : 'bg-green-500';

                container.innerHTML += `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-3">
                            <h5 class="font-semibold text-gray-800 truncate" title="${vrf}">
                                <i class="fas fa-tag mr-2 text-purple-600"></i>${vrf}
                            </h5>
                            <span class="text-xs ${utilizationColor} font-semibold">${utilization}%</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-600">Total:</span>
                                <span class="font-semibold">${total.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-600">Used:</span>
                                <span class="font-semibold text-red-600">${used.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-600">Available:</span>
                                <span class="font-semibold text-green-600">${available.toLocaleString()}</span>
                            </div>
                        </div>
                        <div class="mt-3 bg-gray-200 rounded-full h-1.5">
                            <div class="${progressColor} h-1.5 rounded-full transition-all" style="width: ${utilization}%"></div>
                        </div>
                    </div>
                `;
            });
        }

        // Load subnet overview
        async function loadSubnetOverview() {
            try {
                const response = await fetch('/api/subnet-overview');
                const subnets = await response.json();

                const grid = document.getElementById('subnet-overview-grid');
                grid.innerHTML = '';

                if (subnets.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No subnet data available</div>';
                    return;
                }

                subnets.slice(0, 8).forEach(subnet => {
                    const usageColor = subnet.usage_percent > 80 ? 'text-red-600' : 
                                     subnet.usage_percent > 50 ? 'text-yellow-600' : 'text-green-600';
                    
                    const typeLabel = subnet.subnet_type || (subnet.is_private ? 'private' : 'public');
                    const typeColor = getTypeColor(typeLabel);

                    // Use actual calculated available IPs
                    const actualAvailable = subnet.actual_available || 0;
                    const networkSize = subnet.network_size || subnet.total_ips;
                    const usedIPs = subnet.used_ips || 0;

                    grid.innerHTML += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer" 
                             onclick="quickAnalyzeSpecificSubnet('${subnet.subnet}')">
                            <div class="flex justify-between items-start mb-2">
                                <div class="text-sm font-medium text-gray-800">${subnet.subnet}</div>
                                <span class="text-xs px-2 py-1 rounded-full ${typeColor}">${typeLabel}</span>
                            </div>
                            <div class="space-y-1">
                                <div class="text-xs text-gray-600">Network Size: <span class="font-semibold">${networkSize.toLocaleString()}</span></div>
                                <div class="text-xs text-gray-600">Used: <span class="font-semibold text-red-600">${usedIPs.toLocaleString()}</span></div>
                                <div class="text-xs text-gray-600">Available: <span class="font-semibold text-green-600">${actualAvailable.toLocaleString()}</span></div>
                                <div class="text-xs text-gray-600">Usage: <span class="font-semibold ${usageColor}">${subnet.usage_percent}%</span></div>
                            </div>
                            <div class="mt-3 bg-gray-200 rounded-full h-1.5">
                                <div class="bg-purple-600 h-1.5 rounded-full" style="width: ${subnet.usage_percent}%"></div>
                            </div>
                        </div>
                    `;
                });

                if (subnets.length > 8) {
                    grid.innerHTML += `
                        <div class="border border-gray-200 rounded-lg p-4 text-center text-gray-500">
                            <div class="text-sm">+${subnets.length - 8} more subnets</div>
                            <div class="text-xs mt-1">Click to view all</div>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error loading subnet overview:', error);
                const grid = document.getElementById('subnet-overview-grid');
                grid.innerHTML = '<div class="col-span-full text-center py-8 text-red-500">Error loading subnet data</div>';
            }
        }

        function getTypeColor(type) {
            switch(type) {
                case 'public': return 'bg-blue-100 text-blue-800';
                case 'private': return 'bg-green-100 text-green-800';
                case 'wan': return 'bg-orange-100 text-orange-800';
                case 'global': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Load IP data
        async function loadIPData(page = 1) {
            try {
                const search = document.getElementById('search-input')?.value || '';
                const status = document.getElementById('status-filter')?.value || '';
                const limit = 50;

                const params = new URLSearchParams({
                    page: page,
                    limit: limit,
                    search: search,
                    status: status
                });

                const response = await fetch(`/api/ip-data?${params}`);
                const result = await response.json();

                const tbody = document.getElementById('ip-table-body');
                tbody.innerHTML = '';

                if (result.data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                                No IP addresses found matching your criteria
                            </td>
                        </tr>
                    `;
                    return;
                }

                result.data.forEach(ip => {
                    const statusClass = 
                        ip.status === 'used' ? 'bg-red-100 text-red-800' :
                        ip.status === 'available' ? 'bg-green-100 text-green-800' :
                        'bg-yellow-100 text-yellow-800';

                    const lastUpdated = ip.updated_at ? 
                        new Date(ip.updated_at).toLocaleDateString() : '-';

                    const row = `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">${ip.ip_address}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                                    ${ip.status.charAt(0).toUpperCase() + ip.status.slice(1)}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${ip.subnet || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${ip.vrf_vpn || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${ip.hostname || '-'}</td>
                            <td class="px-6 py-4 text-sm text-gray-600" style="max-width: 200px;">
                                <div class="truncate" title="${ip.description || ''}">${ip.description || '-'}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${lastUpdated}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <div class="flex space-x-2">
                                    <button onclick="editIP(${ip.id})" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteIP(${ip.id})" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });

                // Update pagination
                currentPage = result.page;
                totalPages = result.total_pages;

                document.getElementById('showing-from').textContent = ((page - 1) * limit) + 1;
                document.getElementById('showing-to').textContent = Math.min(page * limit, result.total);
                document.getElementById('showing-total').textContent = result.total.toLocaleString();
                document.getElementById('current-page').textContent = page;
                document.getElementById('total-pages').textContent = totalPages;

                document.getElementById('prev-btn').disabled = page <= 1;
                document.getElementById('next-btn').disabled = page >= totalPages;

            } catch (error) {
                console.error('Error loading IP data:', error);
                const tbody = document.getElementById('ip-table-body');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-8 text-center text-red-500">
                            Error loading IP data. Please try again.
                        </td>
                    </tr>
                `;
            }
        }

        // Pagination
        function previousPage() {
            if (currentPage > 1) {
                loadIPData(currentPage - 1);
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                loadIPData(currentPage + 1);
            }
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('status-filter').value = '';
            loadIPData(1);
        }

        // Refresh data
        function refreshData() {
            loadStatistics();
            loadIPData(currentPage);
            loadSubnetOverview();
            loadAdvancedMonitoring();
            showSuccess('Data refreshed successfully');
        }

        // Quick analyze subnet
        function quickAnalyzeSubnet() {
            const subnet = document.getElementById('quick-subnet-input').value.trim();
            if (subnet) {
                document.getElementById('subnet-input').value = subnet;
                showSection('analyze-subnet');
                analyzeSubnet();
            } else {
                showError('Please enter a subnet');
            }
        }

        function quickAnalyzeSpecificSubnet(subnet) {
            document.getElementById('subnet-input').value = subnet;
            showSection('analyze-subnet');
            analyzeSubnet();
        }

        // Subnet Analysis Functions
        async function analyzeSubnet() {
            const subnet = document.getElementById('subnet-input').value.trim();
            
            if (!subnet) {
                showError('Please enter a subnet (e.g., 172.207.0.0/16)');
                return;
            }

            try {
                const response = await fetch(`/api/subnet-analysis?subnet=${encodeURIComponent(subnet)}`);
                const result = await response.json();

                if (response.ok) {
                    subnetData = result.ip_list;
                    subnetCurrentPage = 1;
                    subnetTotalPages = Math.ceil(subnetData.length / subnetPageSize);
                    
                    // Update subnet info
                    document.getElementById('subnet-network').textContent = result.network_address;
                    document.getElementById('subnet-mask').textContent = result.subnet_mask;
                    document.getElementById('subnet-total').textContent = result.total_ips.toLocaleString();
                    document.getElementById('subnet-utilization').textContent = result.utilization_percent + '%';
                    document.getElementById('subnet-used').textContent = result.used_ips.toLocaleString();
                    document.getElementById('subnet-available').textContent = result.available_ips.toLocaleString();
                    
                    // Count reserved IPs
                    const reservedCount = subnetData.filter(ip => ip.status === 'reserved').length;
                    document.getElementById('subnet-reserved').textContent = reservedCount.toLocaleString();
                    
                    // Show results
                    document.getElementById('subnet-analysis-results').classList.remove('hidden');
                    
                    // Load first page
                    displaySubnetPage(1);
                    
                } else {
                    showError(result.error || 'Failed to analyze subnet');
                }

            } catch (error) {
                console.error('Error analyzing subnet:', error);
                showError('Failed to analyze subnet');
            }
        }

        function displaySubnetPage(page) {
            const startIndex = (page - 1) * subnetPageSize;
            const endIndex = Math.min(startIndex + subnetPageSize, subnetData.length);
            const pageData = subnetData.slice(startIndex, endIndex);

            const tbody = document.getElementById('subnet-table-body');
            tbody.innerHTML = '';

            pageData.forEach(ip => {
                const statusClass = 
                    ip.status === 'used' ? 'bg-red-100 text-red-800' :
                    ip.status === 'available' ? 'bg-green-100 text-green-800' :
                    'bg-orange-100 text-orange-800';

                const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm font-mono text-gray-900">${ip.ip_address}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                                ${ip.status.charAt(0).toUpperCase() + ip.status.slice(1)}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-600">${ip.hostname || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600" title="${ip.description}">
                            ${ip.description ? (ip.description.length > 40 ? ip.description.substring(0, 40) + '...' : ip.description) : '-'}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-600">${ip.vrf_vpn || '-'}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Update pagination info
            document.getElementById('subnet-showing-from').textContent = startIndex + 1;
            document.getElementById('subnet-showing-to').textContent = endIndex;
            document.getElementById('subnet-showing-total').textContent = subnetData.length.toLocaleString();
            document.getElementById('subnet-current-page').textContent = page;
            document.getElementById('subnet-total-pages').textContent = subnetTotalPages;

            // Update pagination buttons
            document.getElementById('subnet-prev-btn').disabled = page <= 1;
            document.getElementById('subnet-next-btn').disabled = page >= subnetTotalPages;

            subnetCurrentPage = page;
        }

        function previousSubnetPage() {
            if (subnetCurrentPage > 1) {
                displaySubnetPage(subnetCurrentPage - 1);
            }
        }

        function nextSubnetPage() {
            if (subnetCurrentPage < subnetTotalPages) {
                displaySubnetPage(subnetCurrentPage + 1);
            }
        }

        function clearSubnetAnalysis() {
            document.getElementById('subnet-input').value = '';
            document.getElementById('subnet-analysis-results').classList.add('hidden');
            subnetData = [];
            subnetCurrentPage = 1;
            subnetTotalPages = 1;
        }

        // Modal functions
        function openAddModal() {
            document.getElementById('modal-title').textContent = 'Add New IP Address';
            document.getElementById('edit-id').value = '';
            document.getElementById('ip-form').reset();
            document.getElementById('ip-modal').classList.remove('hidden');
            document.getElementById('ip-modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('ip-modal').classList.add('hidden');
            document.getElementById('ip-modal').classList.remove('flex');
        }

        // Edit IP
        async function editIP(id) {
            document.getElementById('modal-title').textContent = 'Edit IP Address';
            document.getElementById('edit-id').value = id;
            document.getElementById('ip-modal').classList.remove('hidden');
            document.getElementById('ip-modal').classList.add('flex');
        }

        // Save IP
        async function saveIP() {
            try {
                const editId = document.getElementById('edit-id').value;
                const isEdit = editId !== '';
                
                const data = {
                    ip_address: document.getElementById('ip-address').value,
                    subnet: document.getElementById('subnet').value,
                    status: document.getElementById('status').value,
                    vrf_vpn: document.getElementById('vrf-vpn').value,
                    hostname: document.getElementById('hostname').value,
                    description: document.getElementById('description').value
                };

                let response;
                if (isEdit) {
                    response = await fetch(`/api/update-ip/${editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } else {
                    response = await fetch('/api/add-ip', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                }

                const result = await response.json();

                if (result.success) {
                    closeModal();
                    showSuccess(result.message);
                    loadStatistics();
                    loadIPData(currentPage);
                    loadSubnetOverview();
                } else {
                    showError(result.error);
                }

            } catch (error) {
                console.error('Error saving IP:', error);
                showError('Failed to save IP address');
            }
        }

        // Delete IP
        function deleteIP(id) {
            deleteIPId = id;
            document.getElementById('delete-modal').classList.remove('hidden');
            document.getElementById('delete-modal').classList.add('flex');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
            document.getElementById('delete-modal').classList.remove('flex');
            deleteIPId = null;
        }

        async function confirmDelete() {
            if (!deleteIPId) return;

            try {
                const response = await fetch(`/api/delete-ip/${deleteIPId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    closeDeleteModal();
                    showSuccess(result.message);
                    loadStatistics();
                    loadIPData(currentPage);
                    loadSubnetOverview();
                } else {
                    showError(result.error);
                }

            } catch (error) {
                console.error('Error deleting IP:', error);
                showError('Failed to delete IP address');
            }
        }

        // Utility functions
        function showSuccess(message) {
            alert('Success: ' + message);
        }

        function showError(message) {
            alert('Error: ' + message);
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadIPData(1);
            }
        });

        document.getElementById('status-filter').addEventListener('change', function() {
            loadIPData(1);
        });

        document.getElementById('subnet-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeSubnet();
            }
        });

        document.getElementById('quick-subnet-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                quickAnalyzeSubnet();
            }
        });
    </script>
</body>
</html>
